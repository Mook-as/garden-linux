{
  "builders": [
    {
      "commit": true,
      "image": "{{user `os_name`}}:{{user `os_version`}}",
      "type": "docker"
    }
  ],
  "post-processors": [
    {"repository": "garden-ci-ubuntu", "tag": "packer", "type": "docker-tag"}
  ],
  "provisioners": [
    {"scripts": ["garden-ci/scripts/passwordless_sudo.sh"], "type": "shell"},
    {"scripts": ["garden-ci/scripts/provision.sh"], "type": "shell"},
    {
      "destination": "/opt/warden/rootfs.tar",
      "source": "rootfs/busybox/busybox.tar",
      "type": "file"
    },
    {
      "destination": "/opt/warden/nestable-rootfs.tar",
      "source": "rootfs/ubuntu/ubuntu.tar",
      "type": "file"
    },
    {
      "destination": "/opt/warden/fuse-rootfs.tar",
      "source": "rootfs/fuse/fuse.tar",
      "type": "file"
    },
    {
      "destination": "/opt/warden/docker-registry-rootfs.tar",
      "source": "rootfs/docker_registry/docker_registry.tar",
      "type": "file"
    },
    {
      "destination": "/opt/warden/docker-registry-v2-rootfs.tar",
      "source": "rootfs/docker_registry_v2/docker_registry_v2.tar",
      "type": "file"
    },
    {
      "destination": "/opt/warden/preexisting-users-rootfs.tar",
      "source": "rootfs/preexisting_users/preexisting_users.tar",
      "type": "file"
    },
    {"inline": ["mkdir /opt/warden/empty"], "type": "shell"},
    {
      "destination": "/opt/warden/empty/hello",
      "source": "rootfs/empty/hello",
      "type": "file"
    },
    {
      "inline": [
        "chmod 0777 /opt/warden/empty/hello",
        "mkdir -p /opt/warden/empty/etc",
        "touch /opt/warden/empty/etc/passwd",
        "touch /opt/warden/empty/etc/group",
        "useradd -R /opt/warden/empty -U alice"
      ],
      "type": "shell"
    },
    {"inline": ["useradd -R /opt/warden/empty -U alice"], "type": "shell"},
    {"script": "garden-ci/scripts/untar_rootfses.sh", "type": "shell"},
    {"script": "garden-ci/scripts/build_tar.sh", "type": "shell"},
    {"script": "garden-ci/scripts/cleanup.sh", "type": "shell"}
  ],
  "variables": {"os_name": "ubuntu", "os_version": "14.04.2"}
}

